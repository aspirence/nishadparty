{% extends 'dashboard_base.html' %}

{% block title %}Assign Asset - Nishad Party{% endblock %}

{% block content %}
<style>
    .form-section {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(0, 0, 0, 0.06);
    }

    .form-section .section-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--dark-gray);
        margin-bottom: 1.25rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #f0f0f0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .form-label {
        font-weight: 600;
        color: var(--dark-gray);
        margin-bottom: 0.5rem;
        font-size: 0.875rem;
    }

    .form-control, .form-select {
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 0.625rem 0.875rem;
        font-size: 0.938rem;
        transition: all 0.2s;
    }

    .form-control:focus, .form-select:focus {
        border-color: var(--primary-red);
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.1);
    }

    .form-text {
        font-size: 0.813rem;
        color: #6c757d;
        margin-top: 0.375rem;
    }

    .asset-info-box {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-radius: 12px;
        padding: 1.25rem;
        border-left: 4px solid var(--primary-red);
        margin-bottom: 1.5rem;
    }

    .asset-info-box .info-title {
        font-size: 0.938rem;
        font-weight: 600;
        color: var(--dark-gray);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .info-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .info-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: #6c757d;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .info-value {
        font-size: 0.938rem;
        color: var(--dark-gray);
        font-weight: 500;
    }

    .action-buttons {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
        margin-top: 1.5rem;
    }

    .btn {
        padding: 0.625rem 1.5rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.938rem;
        transition: all 0.2s;
    }

    .btn-primary {
        background: var(--primary-red);
        border: 2px solid var(--primary-red);
    }

    .btn-primary:hover {
        background: var(--primary-red-dark);
        border-color: var(--primary-red-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
    }

    .btn-secondary {
        background: white;
        border: 2px solid #e0e0e0;
        color: var(--dark-gray);
    }

    .btn-secondary:hover {
        background: #f8f9fa;
        border-color: #cbd5e0;
        transform: translateY(-2px);
    }

    @media (max-width: 768px) {
        .form-section {
            padding: 1.25rem;
        }

        .action-buttons {
            flex-direction: column-reverse;
        }

        .action-buttons .btn {
            width: 100%;
        }

        .info-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="container" style="padding-top: 2rem;">
    <!-- Page Header -->
    <div class="page-header">
        <div>
            <h1 class="page-title">
                <i class="bi bi-box-arrow-right me-2"></i>Assign Asset
            </h1>
            <p class="page-subtitle">Assign an asset to a user for a specific purpose</p>
        </div>
        <div>
            <a href="{% url 'assets:dashboard' %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-1"></i>Go Back
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-10 mx-auto">
            <form method="post">
                {% csrf_token %}

                <!-- Selection Section -->
                <div class="form-section">
                    <div class="section-title">
                        <i class="bi bi-cursor"></i>
                        <span>Selection Details</span>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="asset_id" class="form-label">
                                Select Asset <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" name="asset_id" id="asset_id" required>
                                <option value="">Select Asset...</option>
                                {% for asset in available_assets %}
                                <option value="{{ asset.id }}"
                                        data-condition="{{ asset.get_condition_display }}"
                                        data-location="{{ asset.current_location }}"
                                        {% if selected_asset and selected_asset.id == asset.id %}selected{% endif %}>
                                    {{ asset.name }} ({{ asset.asset_code }}) - {{ asset.get_condition_display }}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="form-text">
                                <i class="bi bi-info-circle me-1"></i>Only available assets are shown
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="user_id" class="form-label">
                                Select User <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" name="user_id" id="user_id" required>
                                <option value="">Select User...</option>
                                {% for user in active_users %}
                                <option value="{{ user.id }}">
                                    {{ user.get_full_name|default:user.phone_number }}
                                    ({{ user.get_user_type_display }})
                                    {% if user.constituency %} - {{ user.constituency }}{% endif %}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="form-text">
                                <i class="bi bi-info-circle me-1"></i>Active users only
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Asset Details (will be populated via JavaScript) -->
                <div id="asset_details" style="display: none;">
                    <div class="asset-info-box">
                        <div class="info-title">
                            <i class="bi bi-info-circle"></i>
                            <span>Asset Information</span>
                        </div>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Current Condition</span>
                                <span class="info-value" id="asset_condition"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Current Location</span>
                                <span class="info-value" id="asset_location"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assignment Details Section -->
                <div class="form-section">
                    <div class="section-title">
                        <i class="bi bi-calendar-check"></i>
                        <span>Assignment Details</span>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="purpose" class="form-label">
                                Assignment Purpose <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" name="purpose" id="purpose" required
                                   placeholder="e.g: Election campaign, Event coverage">
                            <div class="form-text">
                                <i class="bi bi-info-circle me-1"></i>Describe the purpose of this assignment
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="expected_return_date" class="form-label">
                                Expected Return Date <span class="text-danger">*</span>
                            </label>
                            <input type="datetime-local" class="form-control" name="expected_return_date" id="expected_return_date" required>
                            <div class="form-text">
                                <i class="bi bi-info-circle me-1"></i>When should the asset be returned?
                            </div>
                        </div>
                    </div>

                    <div class="mb-0">
                        <label for="admin_notes" class="form-label">
                            Administrative Notes
                        </label>
                        <textarea class="form-control" name="admin_notes" id="admin_notes" rows="4"
                                  placeholder="Any special instructions, handling guidelines, or notes..."></textarea>
                        <div class="form-text">
                            <i class="bi bi-info-circle me-1"></i>Optional: Add any special instructions for the user
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <a href="{% url 'assets:dashboard' %}" class="btn btn-secondary">
                        <i class="bi bi-x-circle me-1"></i>Cancel
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle me-1"></i>Assign Asset
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const assetSelect = document.getElementById('asset_id');
    const assetDetails = document.getElementById('asset_details');
    const assetCondition = document.getElementById('asset_condition');
    const assetLocation = document.getElementById('asset_location');
    const expectedReturnInput = document.getElementById('expected_return_date');
    
    // Set minimum date to tomorrow
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    expectedReturnInput.min = tomorrow.toISOString().slice(0, 16);
    
    // Set default return date to 7 days from now
    const weekFromNow = new Date();
    weekFromNow.setDate(weekFromNow.getDate() + 7);
    expectedReturnInput.value = weekFromNow.toISOString().slice(0, 16);
    
    assetSelect.addEventListener('change', function() {
        const selectedOption = this.options[this.selectedIndex];
        if (selectedOption.value) {
            const condition = selectedOption.dataset.condition;
            const location = selectedOption.dataset.location;
            
            assetCondition.textContent = condition || 'Unknown';
            assetLocation.textContent = location || 'Unknown';
            
            assetDetails.style.display = 'block';
        } else {
            assetDetails.style.display = 'none';
        }
    });
});
</script>
{% endblock %}